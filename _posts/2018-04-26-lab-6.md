---
title: "Machine Learning with MRI Data"
header:
  teaser: /assets/images/Lab6.png
categories:
  - Digital Signal Processing
tags:
  - machine learning
  - mri
toc: true
---

# Introduction
In this project we look at sample fMRI data from the brain to see if we can classify different emotions in a human's brain based on this data. We first use linear and quadratic regression to see if the data can be mapped this way, and then move on the KVM machine learning in MATLAB to see if we can better classify human emotions. 

<figure>
	<a href="/assets/images/Lab6.png"><img src="/assets/images/Lab6.png"></a>
</figure>

# Main Project

## 1. Intro 

Our goal is to use fMRI data to predict a viewer’s emotions while watching a certain TV show in this lab. We will be doing this by looking at the left and right hemispheres of the viewer’s brain and analyzing and predicting what values are the most appropriate to classify the viewer’s emotions during a certain time of the show. This sort of research is important for many different areas of life, such as predicting what sort of purchases a consumer will make or for hospital records to determine how effective different types of treatment are to a patient.  

In order to build an accurate predictor, we will be using a linear approach to predict these values, as well as using a machine learning approach using a training set to improve predictions as the “machine” is given more values, and finally a non-linear approach. By analyzing the results of these 3 different prediction methods, we can hope to build a predictor with as little error as possible. This will be important to determine what sort of emotions can be triggered in the viewer’s mind during certain parts of the show and how to retain their interest in the show.   

## 2. Creation and Improvement of the Predictor 

1. Below is the MATLAB code as well as the figure 1 used to plot the five “predictee” variables as a function of time. As we can see, the data does not have any real shape for any of the variables. All of the variables compared to time just look like a bunch of random sinusoids all mashed together that look very hard to predict. It is clear that building a great predictor for this set of data will be quite a difficult task.  

```
importantData = importdata(‘lab6_data.mat’); 
[xTime,yPredictee] = size(importantData.Ratings_new);
Y = importantData.Ratings_new;
for i = 1:5 
	subplot(2,3,i) 
	plot(Y(:,i)) 
	title(importantData.Ratings_featurenames(i));
end
```

![Figure61]({{ site.url }}/assets/images/figure6-1.PNG)

2. Below is the MATLAB code and graphs in figure 2 and 3 used to generate the random graphs for the left and right sides of the brain. As it can be seen the data is very random just like in the previous problem. It will be difficult to create a predictor that correlates to the different emotions, but many of these graphs have a shape similar to language and motion. 

```
for j = 1:17:85     
	%h = figure;    
	%hold on;     
	subplot(2,3,((j+16)/17))     
	plot(leftHalf(:,j));    
	title(strcat('Random Left Half Data', ' ', int2str(j)))     
	saveas(gcf,strcat('Random Left Half', '.png'));     
	%close(h);
end   
for k = 1:17:85     
	%h = figure;     
	%hold on;      
	subplot(2,3,((k+16)/17))     
	plot(rightHalf(:,k));      
	title(strcat('Random Right Half Data',  ' ', int2str(k)))      
	saveas(gcf,strcat('Random Right Half', '.png'));     
	%close(h); 
end 
```

![Figure62]({{ site.url }}/assets/images/figure6-2.PNG)
![Figure63]({{ site.url }}/assets/images/figure6-3.PNG)

3. The figures below show the sorted correlations values between the left and right half of the brain. For the variables, amusement and language it seems those elements have the greatest correlation to the left half as even though the two start at the same magnitude of correlation in both halves of the brain, there is not as much decay for these 2 variables in the left half of the brain. For motion even though it would be possible to predict using either half, it seems using the left half would be easier as the curve is much more smooth compared to the right half of the brain. Looking at both sides of the brain, it seems amusement, attention, and environmental sounds will be the most difficult to predict as the correlation values are much lower compared to motion and language. But motion and language seem to be the easiest to predict as they have quite a few locations in both sides of the brain where the correlation is over 0.5, which is very promising to use for prediction. As all the graphs decay quite quickly for both sides of the brain, in order to predict what variable is present accurately, it would be wise to only use 5-10 values in order to build a predictor. Below the figures is the code used to create these charts. 

![Figure64]({{ site.url }}/assets/images/figure6-4.PNG)
![Figure65]({{ site.url }}/assets/images/figure6-5.PNG)

```
function [accuracy] = correlation(x,y)
%success is measured using the correlation between the true emotion 
%verses the predicted emotion for the 5 emotions: 
%Amusement, Attention, Environmental Sound, Language, Motion  
x_bar = mean(x); y_bar = mean(y); 
x_diff = x - x_bar; 
y_diff = y - y_bar; 
accuracy = abs(sum(x_diff.*y_diff)/sqrt((sum(x_diff.^2))*sum(y_diff.^2))); 
end 
 
for i = 1:size(leftHalf,2)     
	for j = 1:5          
		accuracy_left(j,i) = correlation(leftHalf(:,i),Y(:,j));       
	end  
end 
for i = 1:5     
	[sorted_accuracy_left(i,:), location_left(i,:)] = sort(accuracy_left(i,:),'descend'); 
end 
for j = 1:5     
	subplot(2,3,j)     
	plot(sorted_accuracy_left(j,:));       
	title(strcat('Left Half Correlation', ' ', importantData.Ratings_featurenames(j)));    
	saveas(gcf,strcat('Correlation Left', '.png')); 
end  
for i = 1:size(rightHalf,2)   
	for j = 1:5        
		accuracy_right(j,i) = correlation(rightHalf(:,i),Y(:,j));    
	end 
end 
for i = 1:5     
	[sorted_accuracy_right(i,:), location_right(i,:)] = sort(accuracy_right(i,:),'descend'); 
end   
for j  = 1:5     
	subplot(2,3,j)    
	plot(sorted_accuracy_right(j,:));  
	title(strcat('Right Half Correlation', ' ', importantData.Ratings_featurenames(j))); 
	saveas(gcf, strcat('Correlation Right', '.png'));
end 
```

The figures below show the 5 best locations and their correlations from both the right and left half of the brain that had the highest correlation for all the predictee variables. The rows are order from top to bottom by predictee variable as: attention, amusement, environmental sounds, language, and motion. The first 5 columns show the locations where the correlation was highest for these predictee variables. For each predictee variable there does not seem to be a location that correlates with a certain location as the spread for each predictee variable’s location is quite wide. Therefore, we cannot predict that a certain location in the brain can be attributed to just a single emotion.   

![Figure66]({{ site.url }}/assets/images/figure6-6.PNG)
![Figure67]({{ site.url }}/assets/images/figure6-7.PNG)
![Figure68]({{ site.url }}/assets/images/figure6-8.PNG)
![Figure69]({{ site.url }}/assets/images/figure6-9.PNG)

Taking these values we calculate the correlation matrix of each of these emotions and generate 5x5 correlation matrices that are displayed below as well as the MATLAB code used to generate these matrices. The correlation within each brain’s hemisphere is much more correlated than with the predictee variable. Each location probably can’t provide independent information because the data is very random. 

```
for i = 1:5     
	newLeft_amusement(:,i) = leftHalf(:,location_left(1,i));     
	newLeft_attention(:,i) = leftHalf(:,location_left(2,i));   
	newLeft_environ(:,i) = leftHalf(:,location_left(3,i));    
	newLeft_language(:,i) = leftHalf(:,location_left(4,i));     
	newLeft_motion(:,i) = leftHalf(:,location_left(5,i));     
end   
for i = 1:5    
	for j = 1:5        
		accuracy_left_amusement(i,j) = correlation(newLeft_amusement(:,i), newLeft_amusement(:,j));         					accuracy_left_attention(i,j) = correlation(newLeft_attention(:,i), newLeft_attention(:,j));         					accuracy_left_environ(i,j) = correlation(newLeft_environ(:,i), newLeft_environ(:,j));         
		accuracy_left_language(i,j) = correlation(newLeft_language(:,i), newLeft_language(:,j));         
		accuracy_left_motion(i,j) = correlation(newLeft_motion(:,i), newLeft_motion(:,j));    
	end 
end   
for i = 1:5     
	newRight_amusement(:,i) = rightHalf(:,location_right(1,i));    
	newRight_attention(:,i) = rightHalf(:,location_right(2,i));    
	newRight_environ(:,i) = rightHalf(:,location_right(3,i));     
	newRight_language(:,i) = rightHalf(:,location_right(4,i));    
	newRight_motion(:,i) = rightHalf(:,location_right(5,i));        
end   
for i = 1:5    
	for j = 1:5         
		accuracy_right_amusement(i,j) = correlation(newRight_amusement(:,i), newRight_amusement(:,j));         
		accuracy_right_attention(i,j) = correlation(newRight_attention(:,i), newRight_attention(:,j));         
		accuracy_right_environ(i,j) = correlation(newRight_environ(:,i), newRight_environ(:,j));         
		accuracy_right_language(i,j) = correlation(newRight_language(:,i), newRight_language(:,j));         
		accuracy_right_motion(i,j) = correlation(newRight_motion(:,i), newRight_motion(:,j));   
	end 
end 
```


